<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rune Time Calculator</title>
<style>
  :root {
    --color-primary: #3a86ff;
    --color-bg: #f5f7fa;
    --color-card-bg: #ffffff;
    --color-text: #333;
    --color-muted: #666;
    --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    --transition: 0.3s ease;
  }

  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    font-family: var(--font-family);
    background-color: var(--color-bg);
    color: var(--color-text);
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  header {
    background-color: var(--color-primary);
    color: white;
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  header h1 {
    margin: 0;
    font-weight: 700;
    font-size: 1.5rem;
  }

  header a {
    color: #dbe9ff;
    text-decoration: none;
    font-weight: 500;
    transition: color 0.3s;
  }

  header a:hover {
    color: white;
    text-decoration: underline;
  }

  main {
    flex-grow: 1;
    padding: 2rem;
    max-width: 1200px;
    margin: 0 auto;
  }

  .controls {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 2rem;
    align-items: center;
  }

  .controls input[type="text"],
  .controls input[type="number"] {
    padding: 0.5rem 1rem;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    transition: border-color var(--transition);
  }

  .controls input[type="text"]:focus,
  .controls input[type="number"]:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 5px var(--color-primary);
  }

  .controls label {
    display: flex;
    align-items: center;
    font-size: 0.95rem;
    color: var(--color-muted);
    cursor: pointer;
  }

  .controls label input[type="checkbox"] {
    margin-right: 0.5rem;
    cursor: pointer;
  }

  .controls select {
    padding: 0.5rem 1rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 1rem;
    cursor: pointer;
    transition: border-color var(--transition);
  }

  .controls select:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 5px var(--color-primary);
  }

  .runes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
    gap: 1.5rem;
  }

  .rune-card {
    background: var(--color-card-bg);
    border-radius: 12px;
    box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
    padding: 1rem 1.5rem;
    display: flex;
    flex-direction: column;
    transition: transform var(--transition), opacity var(--transition);
  }

  .rune-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgb(0 0 0 / 0.15);
  }

  .rune-icon {
    font-size: 3rem;
    align-self: center;
    margin-bottom: 0.5rem;
    color: var(--color-primary);
  }

  .rune-name {
    font-weight: 700;
    font-size: 1.3rem;
    margin: 0.3rem 0 0.6rem;
    text-align: center;
  }

  .rune-info {
    font-size: 0.95rem;
    margin-bottom: 0.3rem;
    color: var(--color-text);
    line-height: 1.3;
  }

  .rune-info strong {
    color: var(--color-primary);
  }

  .rune-rating {
    margin-top: auto;
    font-size: 1rem;
    font-weight: 600;
    color: var(--color-primary);
    text-align: center;
  }

  .stats {
    margin-top: 2rem;
    font-size: 1.1rem;
    color: var(--color-text);
    border-top: 1px solid #ddd;
    padding-top: 1rem;
  }

  @media (max-width: 600px) {
    header {
      flex-direction: column;
      gap: 0.5rem;
      text-align: center;
    }

    .controls {
      flex-direction: column;
      gap: 0.8rem;
    }
  }
</style>
</head>
<body>

<header>
  <h1>Rune Time Calculator</h1>
  <a href="https://docs.google.com/document/d/your-google-doc-id" target="_blank" rel="noopener noreferrer">
    📄 Comprehensive Google Doc
  </a>
</header>

<main>
  <section class="controls" aria-label="Rune filters and sorting">
    <input
      type="text"
      id="searchInput"
      placeholder="Filter runes by name..."
      aria-label="Filter runes by name"
      autocomplete="off"
    />
    <label for="hideInstant">
      <input type="checkbox" id="hideInstant" />
      Hide Instant Runes
    </label>
    <select id="sortSelect" aria-label="Sort runes">
      <option value="easiest">Easiest First</option>
      <option value="name">Name A-Z</option>
      <option value="time">Time Ascending</option>
      <option value="rating">Rating Descending</option>
    </select>
    <label for="userRPS" style="margin-left:auto; min-width:180px;">
      Your RPS:
      <input
        type="number"
        id="userRPS"
        min="0.0001"
        step="0.0001"
        value="0.01"
        aria-label="User Runes per Second"
        style="width:80px; margin-left: 0.5rem;"
      />
    </label>
  </section>

  <section class="runes-grid" id="runesGrid" aria-live="polite" aria-label="Runes list">
    <!-- Rune cards will be rendered here -->
  </section>

  <section class="stats" id="statsSection" aria-live="polite" aria-atomic="true">
    <!-- User stats -->
  </section>
</main>

<script>
  // Rune data with extended parameters
  const runes = [
    {
      id: 1,
      name: "Flame Rune",
      time: 120, // base time for 1 rune (seconds)
      rating: 4.5,
      instant: false,
      icon: "🔥",
      chance: 0.15,
      boost: 2.5,
      boostType: "linear",
      maxBoostAmount: 10,
    },
    {
      id: 2,
      name: "Water Rune",
      time: 30,
      rating: 3.7,
      instant: true,
      icon: "💧",
      chance: 0.3,
      boost: 1.1,
      boostType: "linear",
      maxBoostAmount: 15,
    },
    {
      id: 3,
      name: "Vanta",
      time: 180,
      rating: 4.9,
      instant: false,
      icon: "🌍",
      chance: 7e95,
      boost: 1.000015,
      boostType: "exponential",
      maxBoostAmount: 3000000,
    },
    {
      id: 4,
      name: "Wind Rune",
      time: 15,
      rating: 3.2,
      instant: true,
      icon: "💨",
      chance: 0.45,
      boost: 1.2,
      boostType: "linear",
      maxBoostAmount: 20,
    },
    {
      id: 5,
      name: "Light Rune",
      time: 300,
      rating: 5.0,
      instant: false,
      icon: "✨",
      chance: 0.05,
      boost: 3,
      boostType: "linear",
      maxBoostAmount: 5,
    },
  ];

  const searchInput = document.getElementById("searchInput");
  const hideInstantCheckbox = document.getElementById("hideInstant");
  const sortSelect = document.getElementById("sortSelect");
  const runesGrid = document.getElementById("runesGrid");
  const statsSection = document.getElementById("statsSection");
  const userRPSInput = document.getElementById("userRPS");

  function formatTime(seconds) {
    if (seconds === Infinity) return "∞";
    if (seconds === null || seconds === undefined) return "-";
    const m = Math.floor(seconds / 60);
    const s = Math.round(seconds % 60);
    return m > 0 ? `${m}m ${s}s` : `${s}s`;
  }

  // Calculate time to max boost ONLY for exponential boostType
  function calcMaxBoostTime(rune, userRPS) {
    if (userRPS <= 0) return Infinity;

    if (rune.boostType === "exponential") {
      // Простое приближение: базовое время * максимальное количество бустов / RPS
      return (rune.time * rune.maxBoostAmount) / userRPS;
    }

    // Для линейных и других типов не считаем
    return null;
  }

  function renderRunes() {
    const filterText = searchInput.value.toLowerCase();
    const hideInstant = hideInstantCheckbox.checked;
    const sortBy = sortSelect.value;
    const userRPS = parseFloat(userRPSInput.value) || 0.01;

    let filteredRunes = runes.filter(rune => {
      const matchName = rune.name.toLowerCase().includes(filterText);
      const matchInstant = hideInstant ? !rune.instant : true;
      return matchName && matchInstant;
    });

    filteredRunes.sort((a, b) => {
      switch (sortBy) {
        case "easiest":
          return a.time - b.time;
        case "name":
          return a.name.localeCompare(b.name);
        case "time":
          return a.time - b.time;
        case "rating":
          return b.rating - a.rating;
        default:
          return 0;
      }
    });

    runesGrid.innerHTML = "";

    if (filteredRunes.length === 0) {
      runesGrid.innerHTML = `<p>No runes found.</p>`;
      statsSection.textContent = "";
      return;
    }

    filteredRunes.forEach(rune => {
      const timeToGetOneRune = rune.time / userRPS;
      const maxBoostTime = calcMaxBoostTime(rune, userRPS);
      const maxBoostTimeStr = formatTime(maxBoostTime);

      const card = document.createElement("article");
      card.className = "rune-card";
      card.setAttribute("tabindex", "0");

      card.innerHTML = `
        <div class="rune-icon" aria-hidden="true">${rune.icon}</div>
        <h3 class="rune-name">${rune.name}</h3>
        <div class="rune-info"><strong>Base time for 1 rune:</strong> ${formatTime(rune.time)}</div>
        <div class="rune-info"><strong>Chance:</strong> ${(rune.chance * 100).toFixed(1)}%</div>
        <div class="rune-info"><strong>Boost type:</strong> ${rune.boostType.charAt(0).toUpperCase() + rune.boostType.slice(1)}</div>
        <div class="rune-info"><strong>Boost value:</strong> ${rune.boost}</div>
        <div class="rune-info"><strong>Max boost amount:</strong> ${rune.maxBoostAmount.toLocaleString()}</div>
        <div class="rune-info"><strong>Time to get 1 rune at your RPS:</strong> ${formatTime(timeToGetOneRune)}</div>
        <div class="rune-info"><strong>Time to max boost at your RPS:</strong> ${maxBoostTimeStr}</div>
        <div class="rune-rating">Rating: ${rune.rating.toFixed(1)}</div>
      `;

      runesGrid.appendChild(card);
    });

    updateStats(filteredRunes, userRPS);
  }

  function updateStats(runesArray, userRPS) {
    const totalTime = runesArray.reduce((sum, r) => sum + r.time, 0);
    const avgRating =
      runesArray.reduce((sum, r) => sum + r.rating, 0) / runesArray.length;
    const rps = userRPS.toFixed(4);

    statsSection.innerHTML = `
      <strong>Current Stats:</strong><br/>
      Total Runes: ${runesArray.length} <br/>
      Total Base Time: ${formatTime(totalTime)} <br/>
      Average Rating: ${avgRating.toFixed(2)} <br/>
      Your RPS (Runes per second): ${rps}
    `;
  }

  searchInput.addEventListener("input", renderRunes);
  hideInstantCheckbox.addEventListener("change", renderRunes);
  sortSelect.addEventListener("change", renderRunes);
  userRPSInput.addEventListener("input", () => {
    let val = parseFloat(userRPSInput.value);
    if (val < 0.0001 || isNaN(val)) userRPSInput.value = "0.0001";
    renderRunes();
  });

  // Initial render
  renderRunes();
</script>

</body>
</html>
